<div class="page-header">
  <h2>{{ 'cabinets.title' | translate }}</h2>

  <button class="btn-primary"
          [routerLink]="['/admin/cabinets/create']">
    + {{ 'cabinets.add' | translate }}
  </button>
</div>

<div class="table-wrapper">
  <table class="premium-table">
    <thead>
    <tr>
      <th>{{ 'cabinets.columns.cabinet' | translate }}</th>
      <th>{{ 'cabinets.columns.plan' | translate }}</th>
      <th>{{ 'cabinets.columns.status' | translate }}</th>
      <th>{{ 'cabinets.columns.expires' | translate }}</th>
      <th>{{ 'cabinets.columns.users' | translate }}</th>
      <th>{{ 'cabinets.columns.patients' | translate }}</th>
      <th>{{ 'cabinets.columns.price' | translate }}</th>
      <th>{{ 'cabinets.columns.actions' | translate }}</th>
    </tr>
    </thead>

    <tbody>
      @for (cabinet of cabinets(); track cabinet.id) {
        <tr [class.expired]="cabinet.subscriptionStatus === 'EXPIRED'">

          <td>
            <div class="cabinet-name">{{ cabinet.name }}</div>
            <div class="sub-info">{{ cabinet.email }}</div>
          </td>

          <td>
            <span [class]="getPlanClass(cabinet.planCode)">
              {{ ('plans.' + cabinet.planCode) | translate }}
            </span>
          </td>

          <td>
            <span [class]="getStatusClass(cabinet.subscriptionStatus)">
              {{ ('subscription.status.' + cabinet.subscriptionStatus) | translate }}
            </span>
          </td>

          <td>
            @if (getDaysRemaining(cabinet) !== null) {
              <span [class.warning]="getDaysRemaining(cabinet)! < 7">
                {{ getDaysRemaining(cabinet) }}
                {{ 'cabinets.days' | translate }}
              </span>
            }
          </td>

          <td>{{ cabinet.maxUsers }}</td>
          <td>{{ cabinet.maxPatients }}</td>

          <td>
            {{ cabinet.price }}
            {{ ('currency.' + cabinet.currency) | translate }}
          </td>

          <td class="actions-col">
            <button class="icon-btn"
                    [attr.title]="'common.view' | translate"
                    (click)="openDetails(cabinet)">
              ğŸ‘
            </button>

            <button class="icon-btn"
                    [attr.title]="'common.edit' | translate"
                    [routerLink]="['/admin/cabinets', cabinet.id]">
              âœï¸
            </button>

            @if (isSuperAdmin && isActive(cabinet)) {
              <button class="icon-btn"
                      [attr.title]="'common.loginAs' | translate"
                      (click)="switchContext(cabinet.id, Role.ADMIN)">
                ğŸ”‘
              </button>
            }
          </td>

        </tr>
      }
    </tbody>
  </table>
</div>
@if (selectedCabinet()) {

  <!-- BACKDROP -->
  <div
    class="drawer-backdrop"
    (click)="closeDetails()">
  </div>

  <!-- DRAWER -->
  <div
    class="drawer"
    (click)="$event.stopPropagation()">

    <div class="drawer-header">
      <h3>{{ selectedCabinet()?.name }}</h3>
      <button class="close-btn"
              (click)="closeDetails()">
        âœ•
      </button>
    </div>

    <div class="drawer-content">

      <!-- ===================== -->
      <!-- BASIC INFO -->
      <!-- ===================== -->
      <div class="detail-section">
        <h4>{{ 'cabinets.sections.info' | translate }}</h4>

        <div class="detail-row">
          <span>{{ 'cabinets.form.email' | translate }}</span>
          <strong>{{ selectedCabinet()?.email || '-' }}</strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.phone' | translate }}</span>
          <strong>{{ selectedCabinet()?.phone || '-' }}</strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.address' | translate }}</span>
          <strong>{{ selectedCabinet()?.address || '-' }}</strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.description' | translate }}</span>
          <strong>{{ selectedCabinet()?.description || '-' }}</strong>
        </div>
      </div>

      <!-- ===================== -->
      <!-- SUBSCRIPTION -->
      <!-- ===================== -->
      <div class="detail-section">
        <h4>{{ 'cabinets.sections.subscription' | translate }}</h4>

        <div class="detail-row">
          <span class="plan-badge basic">{{ 'cabinets.form.plan' | translate }}</span>
          <strong>
            {{ ('plans.' + selectedCabinet()?.planCode) | translate }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.status' | translate }}</span>
          <strong>
            {{ ('subscription.status.' + selectedCabinet()?.subscriptionStatus) | translate }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.startDate' | translate }}</span>
          <strong>
            {{ selectedCabinet()?.startDate | date:'mediumDate' }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.endDate' | translate }}</span>
          <strong>
            {{ selectedCabinet()?.endDate | date:'mediumDate' }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.trialEndDate' | translate }}</span>
          <strong>
            {{ selectedCabinet()?.trialEndDate | date:'mediumDate' }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.price' | translate }}</span>
          <strong>
            {{ selectedCabinet()?.price }}
            {{ selectedCabinet()?.currency }}
          </strong>
        </div>

        <div class="detail-row">
          <span>{{ 'cabinets.form.autoRenew' | translate }}</span>
          <strong>
            {{
              selectedCabinet()?.autoRenew
                ? ('common.yes' | translate)
                : ('common.no' | translate)
            }}
          </strong>
        </div>

      </div>

    </div>

    <div class="drawer-footer">
      <button class="btn-primary"
              [routerLink]="['/admin/cabinets', selectedCabinet()?.id]">
        {{ 'common.edit' | translate }}
      </button>
    </div>

  </div>
}

