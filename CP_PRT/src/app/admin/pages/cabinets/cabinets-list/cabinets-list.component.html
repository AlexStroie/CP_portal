<div class="cabinets-header">
  <h2>{{ 'cabinets.title' | translate }}</h2>
  <button class="btn-primary" [routerLink]="['/admin/cabinets/create']">
    + {{ 'cabinets.addCabinet' | translate }}
  </button>
</div>

<table class="cabinets-table">
  <thead>
  <tr>
    <th>{{ 'cabinets.columns.name' | translate }}</th>
    <th>{{ 'cabinets.columns.email' | translate }}</th>
    <th>{{ 'cabinets.columns.phone' | translate }}</th>
    <th>{{ 'cabinets.columns.address' | translate }}</th>
    <th>{{ 'cabinets.columns.status' | translate }}</th>
    <th class="actions-col">{{ 'cabinets.columns.actions' | translate }}</th>
  </tr>
  </thead>

  <tbody>
    @for (cabinet of cabinets(); track cabinet.id) {
      <tr>
        <td>{{ cabinet.name }}</td>

        <td class="email-col">{{ cabinet.email }}</td>
        <td class="email-col">{{ cabinet.phone }}</td>
        <td class="email-col">{{ cabinet.address }}</td>

        <td>
          <span class="status" [ngClass]="cabinet.active ? 'active' : 'inactive'">
            {{
              cabinet.active
                ? ('cabinets.status.active' | translate)
                : ('cabinets.status.inactive' | translate)
            }}
          </span>
        </td>

        <td class="actions-col">

          <!-- Edit -->
          <button
            class="icon-button edit"
            [routerLink]="['/admin/cabinets', cabinet.id]"
            [attr.title]="'cabinets.actions.edit' | translate">
            âœï¸
          </button>

          <!-- Delete -->
          <button
            class="icon-button delete"
            (click)="askDelete(cabinet)"
            [disabled]="isDeleteDisabled(cabinet)"
            [attr.title]="'cabinets.actions.delete' | translate">
            ğŸ—‘ï¸
          </button>

          <!-- Login As (doar SUPER_ADMIN) -->
          @if (isSuperAdmin && cabinet.active) {
            <div class="login-wrapper">

              <button
                class="icon-button login"
                (click)="toggleDropdown(cabinet.id)"
                [attr.title]="'cabinets.actions.loginAs' | translate">
                ğŸ”‘
              </button>

              @if (openDropdownId() === cabinet.id) {
                <div class="dropdown-menu">
                  <button (click)="switchContext(cabinet.id, Role.ADMIN)">
                    {{ 'cabinets.actions.asAdmin' | translate }}
                  </button>
                  <button (click)="switchContext(cabinet.id, Role.USER)">
                    {{ 'cabinets.actions.asUser' | translate }}
                  </button>
                </div>
              }

            </div>
          }
        </td>
      </tr>
    }
  </tbody>
</table>

@if (cabinetToDelete()) {
  <div class="modal-backdrop">
    <div class="modal">
      <h3>{{ 'cabinets.delete.title' | translate }}</h3>

      <p>
        {{
          'cabinets.delete.confirm'
            | translate:{ name: cabinetToDelete()?.name }
        }}
      </p>

      <div class="modal-actions">
        <button class="btn-danger" (click)="confirmDelete()">
          {{ 'cabinets.delete.confirmButton' | translate }}
        </button>

        <button class="btn-secondary" (click)="cancelDelete()">
          {{ 'cabinets.delete.cancelButton' | translate }}
        </button>
      </div>
    </div>
  </div>
}
