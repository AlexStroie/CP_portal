<div class="admin-page">

  <div class="admin-header">
    <h2>
      {{
        id()
          ? ('patients.edit.title' | translate)
          : ('patients.create.title' | translate)
      }}
    </h2>

    <div class="admin-subtitle">
      {{
        id()
          ? ('patients.edit.subtitle' | translate)
          : ('patients.create.subtitle' | translate)
      }}
    </div>
  </div>

  <div class="admin-card">

    <form [formGroup]="form">

      <div class="form-grid form-grid-2">

        <!-- First Name -->
        <div class="form-group">
          <label>{{ 'patients.form.firstName' | translate }}</label>
          <input class="form-control"
                 formControlName="firstName">

          @if (hasError('firstName', 'required')) {
            <div class="error">
              {{ 'patients.validation.firstNameRequired' | translate }}
            </div>
          }
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label>{{ 'patients.form.lastName' | translate }}</label>
          <input class="form-control"
                 formControlName="lastName">

          @if (hasError('lastName', 'required')) {
            <div class="error">
              {{ 'patients.validation.lastNameRequired' | translate }}
            </div>
          }
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label>{{ 'patients.form.phone' | translate }}</label>
          <input class="form-control"
                 formControlName="phone">

          @if (hasError('phone', 'required')) {
            <div class="error">
              {{ 'patients.validation.phoneRequired' | translate }}
            </div>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label>{{ 'patients.form.email' | translate }}</label>
          <input type="email"
                 class="form-control"
                 formControlName="email">

          @if (hasError('email', 'email')) {
            <div class="error">
              {{ 'patients.validation.emailInvalid' | translate }}
            </div>
          }
        </div>

        <!-- Date of Birth -->
        <div class="form-group">
          <label>{{ 'patients.form.dateOfBirth' | translate }}</label>
          <input type="date"
                 class="form-control"
                 formControlName="dateOfBirth">

          @if (hasError('dateOfBirth', 'required')) {
            <div class="error">
              {{ 'patients.validation.dateOfBirthRequired' | translate }}
            </div>
          }
        </div>

        <!-- Cabinet (Super Admin only) -->
        @if (isSuperAdmin()) {
          <div class="form-group">
            <label>{{ 'patients.form.cabinet' | translate }}</label>
            <select class="form-control"
                    formControlName="cabinetId">

              <option [ngValue]="null"></option>

              @for (cab of cabinets(); track cab.id) {
                <option [ngValue]="cab.id">{{ cab.name }}</option>
              }
            </select>

            @if (hasError('cabinetId', 'required')) {
              <div class="error">
                {{ 'patients.validation.cabinetRequired' | translate }}
              </div>
            }
          </div>
        }

        <!-- Notes -->
        <div class="form-group full-width">
          <label>{{ 'patients.form.notes' | translate }}</label>
          <textarea class="form-control"
                    rows="3"
                    formControlName="notes"></textarea>
        </div>

      </div>

      <div class="form-actions">
        <button type="button"
                class="btn-secondary"
                (click)="router.navigate(['/admin/patients'])">
          {{ 'common.cancel' | translate }}
        </button>

        <button type="button"
                class="btn-primary"
                (click)="save()"
                [disabled]="!canSave">

          {{
            saving
              ? ('common.saving' | translate)
              : ('common.save' | translate)
          }}

        </button>
      </div>

    </form>

  </div>

</div>
