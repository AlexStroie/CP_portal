<div class="admin-page">

  <div class="admin-header">
    <h2>{{ 'patients.title' | translate }}</h2>
    <p class="admin-subtitle">
      {{ 'patients.subtitle' | translate }}
    </p>
  </div>

  <div class="admin-card">

    <!-- FILTERS + ACTION -->
    <div class="filters-bar">

      <div class="filters-left">

        <input class="form-control"
               type="text"
               placeholder="{{ 'patients.search' | translate }}"
               [formControl]="name">

        @if (isSuperAdmin) {
          <select class="form-control"
                  [formControl]="cabinetId">
            <option value="">
              {{ 'patients.allCabinets' | translate }}
            </option>

            @for (cab of cabinets(); track cab.id) {
              <option [value]="cab.id">{{ cab.name }}</option>
            }
          </select>
        }

        <select class="form-control"
                #sf (change)="sortField.set(sf.value)">
          <option value="">
            {{ 'patients.noSort' | translate }}
          </option>
          <option value="name">
            {{ 'patients.sort.name' | translate }}
          </option>
        </select>

        <select class="form-control"
                #sd (change)="sortDir.set(sd.value)">
          <option value="asc">
            {{ 'patients.sort.asc' | translate }}
          </option>
          <option value="desc">
            {{ 'patients.sort.desc' | translate }}
          </option>
        </select>

      </div>

      <div class="filters-right">
        <button class="btn-primary"
                [routerLink]="['/admin/patients/create']">
          {{ 'patients.add' | translate }}
        </button>
      </div>

    </div>

    <!-- TABLE -->
    <div class="table-wrapper">

      <table class="premium-table">

        <thead>
        <tr>
          <th>{{ 'patients.columns.name' | translate }}</th>
          <th>{{ 'patients.columns.phone' | translate }}</th>
          <th>{{ 'patients.columns.email' | translate }}</th>
          @if (isSuperAdmin) {
            <th>{{ 'patients.columns.cabinet' | translate }}</th>
          }
          <th class="actions-col">
            {{ 'patients.columns.actions' | translate }}
          </th>
        </tr>
        </thead>

        <tbody>

          @if (filteredPatients().length === 0) {
            <tr>
              <td colspan="5" class="empty-state">
                {{ 'patients.empty' | translate }}
              </td>
            </tr>
          }

          @for (patient of filteredPatients(); track patient.id) {
            <tr>

              <td class="bold">
                {{ patient.firstName }} {{ patient.lastName }}
              </td>

              <td>{{ patient.phone }}</td>
              <td>{{ patient.email }}</td>

              @if (isSuperAdmin) {
                <td>
                  {{ cabinetMap.get(patient.cabinetId) }}
                </td>
              }

              <td class="actions-col">

                <button class="icon-btn edit"
                        [routerLink]="['/admin/patients', patient.id]">
                  âœï¸
                </button>

                <button class="icon-btn delete"
                        (click)="askDelete(patient)">
                  ğŸ—‘ï¸
                </button>

              </td>
            </tr>
          }

        </tbody>
      </table>

    </div>

  </div>
</div>
